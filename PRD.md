# 產品需求文件 (PRD) - 台北市嘉禾社區費用管理系統

## 2. 目標用戶與權限分類 (User Categorization)
系統將用戶分為以下四類，並依據其角色提供不同層級的存取權限：

| 角色代號 | 角色名稱 | 權限說明 | 備註 |
| :--- | :--- | :--- | :--- |
| **EXT** | 一般住戶 / 外部使用者 | 登入後僅能讀取**自家門號**的繳費情況 | 需經核准後方可查看 |
| **KEEP** | 社區管理員 (Gatekeeper) | 讀寫後端網頁設定，協助費用登記 | 受雇於 MGR |
| **MGR** | 社區主委 (Manager) | 完整讀寫權限 (包含前後端、主委糾紛處理) | 負責核准 EXT 權限 |
| **ADMIN** | 網頁管理師 (Admin) | 具備與 MGR 相同的完整讀寫權限，僅用於維護測試 | 帳密比照 GitHub 方式 |

## 3. 核心功能需求

### 3.1 認證與登入 (Authentication)
- **登入介面**: 前端提供統一登入入口，支援帳號密碼輸入。
- **身分判定**: 登入後依據代號 (EXT, KEEP, MGR, ADMIN) 切換對應介面與權限。
- **住戶繫結 (EXT/KEEP/MGR)**: 
    - 除了 ADMIN 之外，其餘角色第一次登入時需選擇/填入對應的**住戶門號**。
    - 系統應自動導向「門號登記頁面」。
    - 允許同一角色註冊多間住戶門號, 並在後端儲存多個門號資料。
    - **明細顯示**: 住戶登入後，系統應顯示其所有已登記的繳費紀錄（管理費、機車費、汽車費其起訖範圍）。

### 3.2 門號核准流程 (Approval Workflow)
- **申請狀態**: 住戶 (EXT) 登記門號後進入「待核准」狀態，此時無法讀取繳費資訊。
- **管理審核**: MGR 或是 KEEP 可在管理員介面查看待核准名單。
- **權限打通**: 核准通過後，系統自動將該帳號與 `localStorage` 中的門號資料連結，EXT 方可進入查詢頁面。

### 3.3 住戶查詢網頁 (Resident Portal - EXT 視角)
- **個人化檢視**: EXT 登入後畫面自動鎖定在其登記的門號。
- **隱私保護**: 禁止 EXT 透過手動切換地址或 URL 查詢其他住戶資料。
- **未授權攔截**: 未登入或未核准者，導向登入頁面或顯示「等待核准中」。

### 3.4 管理後台 (Admin Portal - KEEP/MGR/ADMIN 視角)
- **權限區分**:
    - **KEEP**: 僅能執行後端費用登記、車位調整與住戶申請審核。
    - **MGR / ADMIN**: 擁有一切 KEEP 權限，加上「主委糾紛處理設定」與前端全覽功能。
- **資料保護**: 在部署或交接後，所有社區資料保留在 MGR 端，ADMIN 僅在測試期存取。
- **智慧記憶功能**:
    - **車位數量記憶**: 系統自動記住每個住戶上次登記的機車位和汽車位數量，下次選擇時自動帶入。
    - **繳費期間記憶**: 每個住戶的繳費起算年月和結算年月獨立儲存，切換住戶時自動載入該住戶的設定。若首次設定則使用當前系統時間。

### 3.5 費率與日期邏輯 (維持現有邏輯)
- **管理費**: $800/月。
- **機車費**: 小 ($100), 大 ($200)。
- **汽車費**: 小 ($1200), 大 ($1800)。
- **費率設定者**: 在部屬或交接後只允許MGR修改。
- **日期檢查**:自動修正非法區間並顯示紅色警示 UI。 

### 3.6 報表匯出功能
- **本月已繳名單**:
    - 匯出當月所有已繳費住戶清單
    - 包含詳細欄位：Address（門號）、Floor（樓層）、Mgmt（管理費 Y/-）、Moto（機車費 Y/-）、Car（汽車費 Y/-）、Total（總額）
    - 檔名格式：`嘉禾社區_2026年1月_已繳費名單.pdf`
- **上月至今仍欠繳名單**:
    - 匯出上月至本月尚未繳費的住戶清單
    - 包含詳細欄位：Address（門號）、Floor（樓層）、Mgmt（管理費 Y/N）、Moto（機車費 Y/N）、Car（汽車費 Y/N）、Months（欠繳月份）
    - 檔名格式：`嘉禾社區_上月至本月欠繳名單_2026年1月.pdf`
- **PDF 內容**: 使用英文內容以確保相容性，檔名保留中文以便識別

## 4. 非功能性需求
- **資料儲存**: 使用瀏覽器 `localStorage` 提供輕量化持久化儲存。
- **列印支援**: 登記完成後自動產出符合收據格式的列印預覽，隱藏不必要的 UI 元素（no-print）。
- **響應式設計**: 支援電腦與平板操作。

## 5. 技術架構
- **前端框架**: React 19 + TypeScript.
- **樣式工具**: Tailwind CSS.
- **建置工具**: Vite 6.
- **PDF 生成**: jsPDF + jspdf-autotable.
- **部署流程**: GitHub Actions (Native Pages Deployment).
